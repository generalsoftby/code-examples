import React, { Component } from 'react';
import './Login.scss';
import { connect } from "react-redux";
import { authUser } from "../../../actions/auth/authUser";
import { updateToken } from "../../../actions/token/updateToken";

class Login extends Component {

    state = {
        login: "",
        password: "",
        isErrorValid: false,
    };

    changeLogin = e => {
        this.setState({ login: e.target.value });
    };

    changePassword = e => {
        this.setState({ password: e.target.value });
    }

    userAuth = async e => {
        const { login, password } = this.state;
        this.setState({isErrorValid: false });
        e.preventDefault();

        let formData = new FormData();
        formData.append('username', login); // test_client
        formData.append('password', password); // api-tester

        let token = this.props.token.token;

        let response = await fetch('http://bp.gorodisskyipsecurity.com:8080/api/login/', {
            mode: "cors",
            method: "POST",
            body: formData,
            headers: {
                "X-CSRFToken": token,
            },
            credentials: "include",
        });

        switch (response.status) {
            case 200:
            case 204:
                this.props.dispatch(updateToken());
                this.props.dispatch(authUser());
                break;
            case 400:
                this.setState({
                    isErrorValid: true,
                    password: "",
                });
                break;
            case 500:
                this.props.dispatch(updateToken());
                this.props.dispatch(authUser());
                break;
            default:
                //
        }

    };

    render() {
        return (
            <div>
                <div className="container-login-form uk-position-center">
                    <div data-uk-grid className="uk-margin-remove">
                        <div className="container-login-form-left uk-padding-remove">
                            <div className="block-logo">
                                <svg width="230" height="72" viewBox="0 0 230 72" fill="none" xmlns="http://www.w3.org/2000/svg">
                                    <path d="M25.6995 0C35.1949 0 46.1185 1.68143 49.4742 4.63062C50.401 5.24076 51.0688 5.57607 51.0688 6.13972V39.8431C51.0688 41.0169 50.9239 42.1068 50.5615 43.1967C45.4876 59.9645 25.6995 71.2302 25.6995 71.2302C25.6995 71.2302 5.91134 59.9645 0.837466 43.1967C0.475046 42.1068 0.330078 40.933 0.330078 39.8431V6.13972C0.330078 5.21749 0.972277 5.17017 1.92472 4.63062C6.97644 2.22265 16.2041 0 25.6995 0Z" fill="#3693FF"/>
                                    <path fillRule="evenodd" clipRule="evenodd" d="M175.322 54.4942H174.373V53.0593H176.974V58.6756H175.611V57.6917H175.57C175.488 57.9377 175.322 58.2656 175.116 58.4706C174.786 58.7576 174.373 58.7986 174.001 58.7986C173.341 58.7986 172.928 58.6756 172.515 58.2246C172.061 57.6917 171.979 57.0768 171.979 56.5439V50.8047C171.979 50.0258 172.144 49.4108 172.763 48.9189C173.3 48.509 173.878 48.427 174.373 48.427H174.497C175.24 48.427 175.9 48.6319 176.355 49.0419C176.643 49.2879 176.974 49.8208 176.974 50.7227V51.8295H175.322V50.8047C175.322 50.5177 175.322 50.2307 175.116 50.0258C175.033 49.9438 174.868 49.8208 174.497 49.8208C174.29 49.8208 174.043 49.8208 173.836 50.0668C173.671 50.2717 173.63 50.5587 173.63 50.8047V56.3799C173.63 56.5849 173.63 56.8718 173.795 57.1178C173.878 57.2818 174.125 57.4458 174.538 57.4458C174.868 57.4458 175.075 57.2408 175.116 57.1588C175.199 57.0358 175.281 56.8308 175.281 56.4619V54.4942H175.322Z" fill="#3693FF"/>
                                    <path fillRule="evenodd" clipRule="evenodd" d="M186.387 52.7316C186.593 52.7316 186.841 52.7316 187.006 52.5676C187.254 52.4037 187.254 52.0757 187.254 51.9117V50.8869C187.254 50.4359 187.171 50.313 187.13 50.19C186.965 49.985 186.758 49.944 186.593 49.944H185.643V52.6906H186.387V52.7316ZM187.377 58.6758C187.13 58.2249 187.13 57.8149 187.13 57.487V55.2323C187.13 54.9453 187.13 54.6584 186.882 54.4534C186.717 54.2894 186.469 54.2894 186.304 54.2894H185.643V58.7168H183.992V48.5502H186.717C187.625 48.5502 188.203 48.8372 188.451 49.1651C188.74 49.5341 188.905 50.149 188.905 50.5999V51.7478C188.905 52.1167 188.864 52.6086 188.451 52.9776C188.286 53.1416 187.997 53.3055 187.666 53.3875V53.4285C187.749 53.4695 188.038 53.5515 188.286 53.7565C188.74 54.1664 188.781 54.6584 188.781 55.0683V57.241C188.781 58.1429 188.822 58.4299 189.235 58.5938V58.6758H187.377Z" fill="#3693FF"/>
                                    <path fillRule="evenodd" clipRule="evenodd" d="M198.358 57.323C198.771 57.323 199.018 57.118 199.142 56.995C199.307 56.7901 199.307 56.2981 199.307 56.0932V51.0918C199.307 50.8459 199.307 50.4769 199.142 50.231C198.936 49.985 198.688 49.944 198.44 49.944H197.532V57.282H198.358V57.323ZM195.881 48.5502H199.018C199.349 48.5502 199.927 48.5912 200.422 49.0421C200.959 49.5751 200.959 50.231 200.959 50.8459V56.2571C200.959 56.8311 200.917 57.651 200.298 58.2249C199.844 58.6758 199.266 58.7168 198.853 58.7168H195.881V48.5502Z" fill="#3693FF"/>
                                    <path d="M203.56 48.5502H201.908V58.6758H203.56V48.5502Z" fill="#3693FF"/>
                                    <path fillRule="evenodd" clipRule="evenodd" d="M206.12 55.3143V56.2162C206.12 56.7081 206.161 56.9131 206.203 56.9951C206.368 57.323 206.657 57.405 206.946 57.405C207.111 57.405 207.4 57.405 207.606 57.2C207.771 57.0361 207.771 56.7081 207.771 56.5031V55.8472C207.771 55.4373 207.606 55.0683 207.235 54.6994L205.542 53.1416C205.294 52.8956 205.047 52.6497 204.84 52.3627C204.593 51.9527 204.51 51.5428 204.51 51.0509V50.231C204.51 49.739 204.758 49.2881 205.047 48.9602C205.583 48.4682 206.492 48.3862 206.904 48.3862H207.028C207.606 48.3862 208.267 48.5092 208.762 49.0011C209.299 49.5341 209.34 50.149 209.34 50.5589V51.5838H207.689V50.7639C207.689 50.5179 207.689 50.313 207.482 50.067C207.317 49.903 207.152 49.821 206.904 49.821C206.698 49.821 206.45 49.862 206.285 50.026C206.12 50.19 206.12 50.354 206.12 50.5589V51.0099C206.12 51.3788 206.203 51.5428 206.533 51.8298L208.225 53.3876C208.762 53.8795 209.381 54.4534 209.381 55.5193V56.6671C209.381 57.159 209.34 57.692 208.803 58.2249C208.267 58.7578 207.606 58.7988 207.028 58.7988C206.492 58.7988 205.872 58.7168 205.336 58.3479C204.593 57.815 204.469 57.0771 204.469 56.5441V55.2733H206.12V55.3143Z" fill="#3693FF"/>
                                    <path fillRule="evenodd" clipRule="evenodd" d="M211.815 55.3143V56.2162C211.815 56.7081 211.857 56.9131 211.898 56.9951C212.063 57.323 212.352 57.405 212.641 57.405C212.806 57.405 213.095 57.405 213.302 57.2C213.467 57.0361 213.467 56.7081 213.467 56.5031V55.8472C213.467 55.4373 213.302 55.0683 212.93 54.6994L211.237 53.1416C210.99 52.8956 210.742 52.6497 210.536 52.3627C210.288 51.9527 210.205 51.5428 210.205 51.0509V50.231C210.205 49.739 210.453 49.2881 210.742 48.9602C211.279 48.4682 212.187 48.3862 212.6 48.3862H212.724C213.302 48.3862 213.962 48.5092 214.457 49.0011C214.994 49.5341 215.035 50.149 215.035 50.5589V51.5838H213.384V50.7639C213.384 50.5179 213.384 50.313 213.178 50.067C213.013 49.903 212.847 49.821 212.6 49.821C212.393 49.821 212.146 49.862 211.981 50.026C211.815 50.19 211.815 50.354 211.815 50.5589V51.0099C211.815 51.3788 211.898 51.5428 212.228 51.8298L213.921 53.3876C214.457 53.8795 215.077 54.4534 215.077 55.5193V56.6671C215.077 57.159 215.035 57.692 214.499 58.2249C213.962 58.7578 213.302 58.7988 212.724 58.7988C212.187 58.7988 211.568 58.7168 211.031 58.3479C210.288 57.815 210.164 57.0771 210.164 56.5441V55.2733H211.815V55.3143Z" fill="#3693FF"/>
                                    <path fillRule="evenodd" clipRule="evenodd" d="M215.986 58.6758V48.5502H217.638V52.8546H217.679L219.413 48.5502H221.105L219.124 53.3465L221.353 58.6758H219.661L217.72 53.7975H217.638V58.6758H215.986Z" fill="#3693FF"/>
                                    <path fillRule="evenodd" clipRule="evenodd" d="M223.169 58.6758V54.0844L221.27 48.5502H223.003L223.829 51.6658L223.994 52.0757L224.118 51.6658L224.944 48.5502H226.719L224.82 54.0844V58.6758H223.169Z" fill="#3693FF"/>
                                    <path fillRule="evenodd" clipRule="evenodd" d="M180.525 48.4271H180.401C179.864 48.4271 179.162 48.5501 178.626 49.0011C177.965 49.575 177.924 50.1899 177.924 50.7638V56.4621C177.924 57.036 177.965 57.6509 178.626 58.2248C179.204 58.7167 179.947 58.7987 180.483 58.7987C181.02 58.7987 181.763 58.7167 182.341 58.2248C183.002 57.6509 183.043 57.036 183.043 56.4621V50.7638C183.043 50.1899 183.002 49.575 182.341 49.0011C181.763 48.5091 181.061 48.4271 180.525 48.4271ZM179.575 50.8048C179.575 50.7638 179.575 50.7228 179.575 50.6818C179.575 50.4359 179.699 50.2309 179.823 50.0669C179.988 49.9029 180.194 49.78 180.401 49.78H180.442H180.483C180.731 49.78 180.937 49.9029 181.103 50.1079C181.268 50.2719 181.35 50.5179 181.35 50.8048V53.5924V56.3801C181.35 56.667 181.268 56.913 181.103 57.077C180.937 57.2409 180.731 57.3639 180.483 57.4049H180.442H180.401C180.153 57.4049 179.947 57.2819 179.823 57.118C179.699 56.954 179.575 56.749 179.575 56.503C179.575 56.4621 179.575 56.4211 179.575 56.4211V53.6334V50.8048Z" fill="#3693FF"/>
                                    <path fillRule="evenodd" clipRule="evenodd" d="M192.413 48.4271H192.289C191.753 48.4271 191.051 48.5501 190.514 49.0011C189.854 49.575 189.812 50.1899 189.812 50.7638V56.4621C189.812 57.036 189.854 57.6509 190.514 58.2248C191.092 58.7167 191.835 58.7987 192.372 58.7987C192.909 58.7987 193.652 58.7167 194.23 58.2248C194.89 57.6509 194.932 57.036 194.932 56.4621V50.7638C194.932 50.1899 194.89 49.575 194.23 49.0011C193.611 48.5091 192.95 48.4271 192.413 48.4271ZM191.464 50.8048C191.464 50.7638 191.464 50.7228 191.464 50.6818C191.464 50.4359 191.588 50.2309 191.712 50.0669C191.877 49.9029 192.083 49.78 192.289 49.78H192.331H192.372C192.62 49.78 192.826 49.9029 192.991 50.1079C193.156 50.2719 193.239 50.5179 193.239 50.8048V53.5924V56.3801C193.239 56.667 193.156 56.913 192.991 57.077C192.826 57.2409 192.62 57.3639 192.372 57.4049H192.331H192.289C192.042 57.4049 191.835 57.2819 191.712 57.118C191.588 56.954 191.464 56.749 191.464 56.503C191.464 56.4621 191.464 56.4211 191.464 56.4211V53.6334V50.8048Z" fill="#3693FF"/>
                                    <path d="M72.9261 15.0353H68.3691V44.6623H72.9261V15.0353Z" fill="white"/>
                                    <path fillRule="evenodd" clipRule="evenodd" d="M80.9222 32.6216H84.8773C88.7465 32.6216 91.2399 28.6087 91.2399 23.7421C91.2399 18.9608 88.8325 15.1187 84.9633 15.1187H76.3652V44.7456H80.9222V32.6216ZM80.9222 19.3877H83.2437C85.5652 19.3877 86.6829 20.9245 86.6829 23.7421C86.6829 26.5596 85.5652 28.1818 83.2437 28.1818H80.9222V19.3877Z" fill="white"/>
                                    <path fillRule="evenodd" clipRule="evenodd" d="M113.595 24.3402V23.401C113.595 17.4243 111.016 14.436 106.459 14.436C102.332 14.436 99.4083 17.2536 99.4083 22.1203C99.4083 25.3647 100.612 27.8407 103.02 29.7191L107.061 32.9636C108.78 34.3296 109.554 35.4396 109.554 37.4033C109.554 39.2817 108.608 40.7332 106.889 40.7332C105.169 40.7332 103.535 39.6232 103.535 35.525V34.415H99.1504V35.525C99.1504 41.587 101.73 45.2583 106.803 45.2583C111.618 45.2583 114.197 42.0992 114.197 36.8911C114.197 32.4513 112.649 30.6583 110.07 28.5238L105.427 24.6817C104.481 23.9132 103.879 23.0594 103.879 21.3518C103.879 19.7296 104.997 18.8758 106.287 18.8758C108.092 18.8758 109.124 20.3273 109.124 23.9132V24.2548H113.595V24.3402Z" fill="white"/>
                                    <path fillRule="evenodd" clipRule="evenodd" d="M117.121 15.0338V44.6608H130.018V40.1356H121.678V30.9146H129.244V26.3894H121.678V19.559H130.018V15.0338H117.121Z" fill="white"/>
                                    <path fillRule="evenodd" clipRule="evenodd" d="M147.472 24.6817V23.1448C147.472 17.6805 144.979 14.436 140.336 14.436C135.349 14.436 132.855 17.6805 132.855 24.5963V35.3542C132.855 40.6478 134.317 45.2583 140.25 45.2583C145.925 45.2583 147.472 40.6478 147.472 35.2688V33.9881H142.915V35.6103C142.915 39.4525 142.055 40.7332 140.164 40.7332C138.272 40.7332 137.412 39.4525 137.412 35.6103V23.9986C137.412 20.2419 138.272 18.9612 140.164 18.9612C142.055 18.9612 142.829 20.2419 142.829 23.9986V24.6817H147.472Z" fill="white"/>
                                    <path fillRule="evenodd" clipRule="evenodd" d="M150.824 15.0338V36.7204C150.824 42.0994 153.146 45.2585 158.477 45.2585C163.807 45.2585 166.043 42.0994 166.043 36.7204V15.0338H161.486V35.8666C161.486 39.1965 160.712 40.6479 158.477 40.6479C156.327 40.6479 155.381 39.1111 155.381 35.8666V15.0338H150.824Z" fill="white"/>
                                    <path fillRule="evenodd" clipRule="evenodd" d="M174.041 32.1099H177.395C179.458 32.1099 180.146 34.159 180.146 36.3789V39.7941C180.146 41.6725 180.318 43.7216 181.264 44.6608H185.821V43.7216C184.789 43.7216 184.703 41.5017 184.703 38.7695V35.0128C184.703 32.8783 184.015 30.4023 181.436 29.7192C183.585 29.3777 185.047 27.0724 185.047 22.7181C185.047 18.449 182.725 15.0338 179.028 15.0338H169.57V44.6608H174.127V32.1099H174.041ZM174.041 19.3882H176.965C179.028 19.3882 180.318 20.242 180.318 23.4865C180.318 26.8163 178.684 27.8409 177.137 27.8409H174.041V19.3882Z" fill="white"/>
                                    <path d="M192.87 15.0338H188.312V44.6608H192.87V15.0338Z" fill="white"/>
                                    <path fillRule="evenodd" clipRule="evenodd" d="M205.509 19.559H211.184V15.0338H195.277V19.559H200.952V44.6608H205.509V19.559Z" fill="white"/>
                                    <path fillRule="evenodd" clipRule="evenodd" d="M212.301 15.0338L218.577 31.9391V44.6608H223.134V31.9391L229.669 15.0338H224.51L220.899 26.3894L217.718 15.0338H212.301Z" fill="white"/>
                                    <path d="M33.3611 47.2583H18.4355V51.2421H33.3611V47.2583Z" fill="white"/>
                                    <path d="M160.47 54.397H68.3691V58.7988H160.47V54.397Z" fill="white"/>
                                    <path fillRule="evenodd" clipRule="evenodd" d="M24.5149 43.087H25.2254L26.015 42.9301L26.8834 42.6163L27.594 42.0672L27.9888 41.5966L28.1467 41.4397L28.3835 41.0475L28.6993 40.4199L28.9362 39.8708H29.0151L29.6799 42.6948H32.9628V26.3001H25.4623C25.4623 26.3001 25.3299 27.5432 25.6074 28.3397C25.8849 29.1362 26.8834 30.3792 26.8834 30.3792H28.1467V36.1055L28.0677 36.8115L27.9888 37.4391L27.8309 37.8313L27.673 38.1451L27.4361 38.4588L27.0413 38.6942L26.5676 38.9295L25.936 39.0079L25.0675 38.9295L24.5149 38.6942L24.0412 38.3804L23.7253 38.0666L23.4885 37.5175L23.3306 36.9684V36.4193V19.7109V19.1618L23.4095 18.6127L23.5674 18.0636L23.8833 17.593L24.278 17.2007L24.8307 16.9654L25.3044 16.887H25.4623H25.936L26.4097 16.9654L26.9624 17.1223L27.2782 17.2792L27.594 17.5145L27.9098 17.9852L28.0677 18.5343L28.1467 19.1618V19.7109V22.6133H32.9628V19.4756L32.8049 17.6714L32.4101 16.2594L31.8574 15.2397L31.2258 14.5337L30.1205 13.6708L28.8572 13.2002L27.4361 12.8864L25.936 12.7295H25.4623L24.278 12.8079L23.0937 13.0433L21.9094 13.5139L20.7252 14.2199L19.6198 15.3181L18.9093 16.5732L18.5935 18.0636L18.4355 19.7109V36.4978L18.5145 37.6744L18.7514 38.9295L19.2251 40.1846L20.0146 41.3612L20.962 42.2241L21.9884 42.7732L23.0937 43.0085H23.3306L24.278 43.087H24.5149Z" fill="white"/>
                                    <path d="M164.405 55.0249H164.857C165.235 55.0249 165.363 55.2139 165.363 55.5857C165.363 55.9637 165.21 56.1831 164.844 56.1831H164.405V55.0249ZM164.405 56.8111H164.942C165.253 56.8111 165.405 57.0549 165.405 57.4877C165.405 57.9815 165.253 58.1705 164.942 58.1705H164.405V56.8111ZM163.57 58.7984H165.253C165.93 58.7984 166.259 58.2558 166.259 57.4938C166.259 56.9208 166.039 56.6099 165.606 56.4331C165.972 56.3599 166.198 55.8905 166.198 55.4699C166.198 54.9091 165.887 54.397 165.113 54.397H163.57V58.7984Z" fill="#3693FF"/>
                                    <path d="M166.547 54.397L167.706 56.9086V58.7984H168.541V56.9086L169.73 54.397H168.785L168.12 56.0917L167.535 54.397H166.547Z" fill="#3693FF"/>
                                </svg>
                            </div>
                        </div>
                        <div className="container-login-form-right uk-width-expand">
                            <div className="block-captions">
                                <h1 className="title">Hello! Welcome to «Gorodissky IP Security»</h1>
                                <div className="caption-title">Online Brand Protection Platform</div>
                            </div>
                            <div className="block-form">
                                <form onSubmit={ this.userAuth }>
                                    <div className="block-input">
                                        <label>Name</label>
                                        <input
                                            value={ this.state.username }
                                            onChange={ this.changeLogin }
                                        />
                                    </div>
                                    <div className="block-input block-input-last">
                                        <label>Password</label>
                                        <input
                                            type="password"
                                            value={ this.state.password }
                                            onChange={ this.changePassword }
                                        />
                                    </div>
                                    { this.state.isErrorValid &&
                                        <div className="form-error">Incorrect name or password</div>
                                    }
                                    <button className="btn-login-submit" type="submit">Login</button>
                                </form>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        );
    }
}

export default connect(
    state => ({
        token: state.token
    })
)(Login);


